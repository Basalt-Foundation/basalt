# Basalt.Benchmarks

Performance benchmarks for the Basalt blockchain using [BenchmarkDotNet](https://benchmarkdotnet.org/). Measures cryptographic operations, codec throughput, trie performance, transaction operations, and end-to-end transfer TPS.

## Running

Run all benchmarks (interactive selection):

```bash
dotnet run --project benchmarks/Basalt.Benchmarks -c Release
```

Run a specific benchmark suite:

```bash
dotnet run --project benchmarks/Basalt.Benchmarks -c Release -- --filter "*Crypto*"
dotnet run --project benchmarks/Basalt.Benchmarks -c Release -- --filter "*Codec*"
dotnet run --project benchmarks/Basalt.Benchmarks -c Release -- --filter "*Trie*"
dotnet run --project benchmarks/Basalt.Benchmarks -c Release -- --filter "*Transaction*"
dotnet run --project benchmarks/Basalt.Benchmarks -c Release -- --filter "*TpsMacro*"
```

The entry point uses `BenchmarkSwitcher.FromAssembly` to allow selecting benchmark classes via command-line filters.

## Benchmark Suites

All benchmarks use `[MemoryDiagnoser]` for allocation tracking and `[SimpleJob(warmupCount: 3, iterationCount: 10)]`.

### CryptoBenchmarks

Benchmarks for BLAKE3, Keccak-256, and Ed25519 cryptographic operations.

| Benchmark | Description |
|-----------|-------------|
| `Blake3_32B` | BLAKE3 hash of 32 bytes |
| `Blake3_256B` | BLAKE3 hash of 256 bytes |
| `Blake3_1KB` | BLAKE3 hash of 1 KB |
| `Blake3_64KB` | BLAKE3 hash of 64 KB |
| `Blake3_HashPair` | BLAKE3 Merkle tree node hashing (two Hash256 inputs) |
| `Keccak256_32B` | Keccak-256 hash of 32 bytes |
| `Keccak256_256B` | Keccak-256 hash of 256 bytes |
| `Ed25519_Sign` | Ed25519 signature generation (128-byte message) |
| `Ed25519_Verify` | Ed25519 signature verification |
| `Ed25519_KeyGen` | Ed25519 key pair generation |
| `Ed25519_DeriveAddress` | Public key to Basalt address derivation |

### CodecBenchmarks

Benchmarks for the binary codec (BasaltWriter/BasaltReader) serialization primitives.

| Benchmark | Description |
|-----------|-------------|
| `WriteUInt64` | 100x 8-byte integer serialization |
| `WriteVarInt` | 100x LEB128 variable-length encoding |
| `WriteHash256` | 10x 32-byte hash serialization |
| `WriteAddress` | 10x 20-byte address serialization |
| `WriteUInt256` | 10x 256-bit integer serialization |
| `ReadUInt64` | 100x 8-byte integer deserialization (write then read) |
| `WriteString` | UTF-8 string with length prefix |
| `WriteBlockHeaderPayload` | Full block header serialization (number, hashes, timestamp, proposer, chain ID, gas, protocol version, extra data) |

### TrieBenchmarks

Benchmarks for the Merkle Patricia Trie. Parameterized with `KeyCount`: 100, 1,000, 10,000. Keys are generated by BLAKE3-hashing sequential integers for uniform distribution.

| Benchmark | Description |
|-----------|-------------|
| `Trie_Insert_All` | Insert N keys into a fresh trie (InMemoryTrieNodeStore) |
| `Trie_Get_All` | Read N keys from a pre-populated trie |
| `Trie_Update_All` | Update all N existing keys with new values |
| `Trie_GenerateProof` | Generate Merkle proofs for the first 10 keys |

### TransactionBenchmarks

Benchmarks for individual transaction operations.

| Benchmark | Description |
|-----------|-------------|
| `Tx_Sign` | Sign a transfer transaction (create + Ed25519 sign) |
| `Tx_Verify` | Verify a transaction's Ed25519 signature |
| `Tx_Hash` | Compute transaction hash |

### TpsMacroBenchmark

End-to-end throughput measurement. Uses `[SimpleJob(warmupCount: 1, iterationCount: 3)]`. Parameterized with `TxCount`: 10,000 and 100,000. Pre-signs transactions from 100 accounts.

| Benchmark | Description |
|-----------|-------------|
| `Execute_Transfers` | Pre-sign N transfers, fund sender accounts in an InMemoryStateDb, build blocks of up to 10,000 transactions each via BlockBuilder, measure sustained TPS |

## Dependencies

| Package | Purpose |
|---------|---------|
| `BenchmarkDotNet` | Benchmarking framework with memory diagnostics |
| `Basalt.Core` | Core types (Hash256, Address, UInt256, ChainParameters, Block, Transaction) |
| `Basalt.Crypto` | BLAKE3, Ed25519, Keccak-256 |
| `Basalt.Codec` | BasaltWriter/BasaltReader serialization |
| `Basalt.Storage` | MerklePatriciaTrie, InMemoryTrieNodeStore, InMemoryStateDb |
| `Basalt.Execution` | TransactionExecutor, BlockBuilder, Mempool |
